<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC Manager - Интернет-магазин</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- ОБЪЕДИНЕННЫЕ СТИЛИ (main.css, catalog.css, cart.css) --- */
        
        /* main.css */
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff;
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(to right, #007bff, #0056b3);
            padding: 15px 20px;
            color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .logo {
            width: 50px;
            height: auto;
            margin-right: 15px;
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.1);
        }

        .store-name {
            font-size: 24px;
            margin: 0;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }

        .user-actions-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .action-link {
            display: flex;
            align-items: center;
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.3s;
            font-weight: 500;
        }

        .action-link:hover {
            color: #ffd700;
        }

        .action-icon {
            font-size: 20px;
            margin-right: 8px;
        }

        .cart-count {
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 5px;
            vertical-align: top;
        }

        .search-box {
            display: flex;
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .search-input {
            padding: 8px 15px;
            border: none;
            width: 200px;
            outline: none;
        }

        .search-button {
            padding: 8px 15px;
            background-color: #004085;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-button:hover {
            background-color: #002752;
        }

        /* Навигация */
        .navigation {
            background-color: #e9ecef;
            padding: 10px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .nav-container {
            display: flex;
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .nav-links {
            list-style: none;
            display: flex;
            margin: 0;
            padding: 0;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-links li {
            margin: 0 15px;
        }

        .nav-links a {
            text-decoration: none;
            color: #007bff;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            padding-bottom: 5px;
            border-bottom: 2px solid transparent;
        }

        .nav-links a:hover, .nav-links a.active {
            color: #0056b3;
            border-bottom-color: #0056b3;
        }

        /* Общий контейнер страниц */
        .page-section {
            display: none; /* Скрываем все секции по умолчанию */
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
            animation: fadeIn 0.5s ease-in;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- STYLES: Main Page --- */
        .carousel {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            margin-bottom: 40px;
            border-radius: 15px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            background-color: #ddd;
        }
        
        .carousel-slide {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            font-size: 3rem;
            text-align: center;
            position: absolute;
            opacity: 0;
            transition: opacity 1s;
        }
        .carousel-slide.active { opacity: 1; }
        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .about-section {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* --- STYLES: Catalog (Updated with Tabs & Accordion) --- */
        .category-tabs {
            max-width: 1200px;
            margin: 20px 0 0; 
            display: flex;
            justify-content: flex-start; 
            align-items: flex-end; 
            padding: 0;
            background-color: transparent; 
            border-bottom: 2px solid #e9ecef; 
            flex-wrap: wrap;
        }

        .tab-button {
            flex-grow: 0;
            background-color: transparent;
            border: none;
            padding: 10px 18px; 
            font-size: 16px;
            font-weight: 500;
            color: #333; 
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px 5px 0 0; 
            margin-right: 5px; 
            border-bottom: 2px solid transparent; 
        }

        .tab-button:hover:not(.active) {
            background-color: #f0f8ff; 
            color: #007bff;
        }

        .tab-button.active {
            background-color: white; 
            color: #007bff; 
            font-weight: 700;
            border-color: #007bff; 
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05); 
        }

        .catalog-container {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }

        .filter-sidebar {
            width: 280px;
            flex-shrink: 0;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        /* Accordion Styles */
        .filter-accordion {
            margin-bottom: 10px;
            border: 1px solid #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .accordion-header {
            width: 100%;
            background-color: #f0f8ff; 
            color: #333;
            padding: 10px 15px;
            text-align: left;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s;
        }

        .accordion-header:hover {
            background-color: #e0f2ff;
        }

        .accordion-content {
            padding: 10px 15px;
            border-top: 1px solid #e9ecef;
            display: none; 
            flex-direction: column;
            gap: 8px;
            font-size: 14px;
        }

        .accordion-content.open {
            display: flex; 
        }

        .product-list {
            flex-grow: 1;
        }

        .product-cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .card-image-box {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .product-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .product-title {
            font-size: 16px;
            font-weight: 700;
            color: #004085;
            margin: 0 0 10px 0;
            flex-grow: 1;
            min-height: 42px; /* For alignment */
        }

        .product-price {
            font-size: 20px;
            font-weight: 900;
            color: #dc3545;
            margin: 10px 0;
        }

        .buy-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px;
            width: 100%;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .buy-button:hover {
            background-color: #1e7e34;
        }

        /* --- STYLES: Cart --- */
        .cart-content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .cart-items-list, .cart-summary {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            padding: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e9ecef;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .item-info {
            display: flex;
            align-items: center;
            flex: 1;
            min-width: 200px;
        }

        .item-details {
            margin-left: 15px;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            background: #f0f8ff;
            border: 1px solid #007bff;
            color: #007bff;
            cursor: pointer;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .promo-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }
        
        .promo-list-link {
            display: block;
            margin-top: 10px;
            color: #007bff;
            font-size: 0.9em;
            text-decoration: underline;
            cursor: pointer;
        }

        /* --- STYLES: Auth --- */
        .auth-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .auth-form input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .auth-btn {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .toggle-auth {
            margin-top: 15px;
            color: #007bff;
            cursor: pointer;
            font-size: 14px;
        }

        .footer {
            background: linear-gradient(to right, #007bff, #0056b3);
            color: white;
            text-align: center;
            padding: 15px;
            margin-top: auto;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .catalog-container, .cart-content-grid {
                flex-direction: column;
                grid-template-columns: 1fr;
            }
            .filter-sidebar { width: 100%; }
            .header-container { flex-direction: column; }
            .nav-links { justify-content: center; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo-section" onclick="app.navigate('home')">
                <i class="fas fa-desktop fa-2x logo"></i>
                <h1 class="store-name">PC Manager</h1>
            </div>

            <div class="search-box">
                <input type="text" id="global-search" placeholder="Поиск товаров..." class="search-input">
                <button onclick="app.search()" class="search-button"><i class="fas fa-search"></i></button>
            </div>

            <div class="user-actions-section">
                <a onclick="app.navigate('cart')" class="action-link">
                    <i class="fas fa-shopping-cart action-icon"></i>
                    <span>Корзина</span>
                    <span id="header-cart-count" class="cart-count">0</span>
                </a>
                <a id="auth-link" onclick="app.handleAuthClick()" class="action-link">
                    <i class="fas fa-user action-icon"></i>
                    <span id="auth-text">Войти</span>
                </a>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navigation">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a onclick="app.navigate('home')">Главная</a></li>
                <li><a onclick="app.navigate('catalog', 'all')">Каталог</a></li>
                <li><a onclick="app.navigate('catalog', 'pc')">Комплектующие</a></li>
                <li><a onclick="app.navigate('catalog', 'laptop')">Ноутбуки</a></li>
                <li><a onclick="app.navigate('catalog', 'monoblock')">Моноблоки</a></li>
                <li><a onclick="app.navigate('promocodes')">Промокоды</a></li>
            </ul>
        </div>
    </nav>

    <!-- MAIN PAGE SECTION -->
    <main id="home-section" class="page-section active">
        <div class="carousel">
            <div class="carousel-slide active" style="background: linear-gradient(135deg, #1e3c72, #2a5298);">
                <div>
                    <h2>Новинки 2025</h2>
                    <p>RTX 5090 уже в наличии!</p>
                </div>
            </div>
            <div class="carousel-slide" style="background: linear-gradient(135deg, #11998e, #38ef7d);">
                <div>
                    <h2>Летняя распродажа</h2>
                    <p>Скидки до 30% на ноутбуки</p>
                </div>
            </div>
        </div>

        <section class="about-section">
            <h2 style="color: #007bff;">Добро пожаловать в PC Manager</h2>
            <p>Мы предлагаем лучший выбор комплектующих, ноутбуков и моноблоков. Собирайте ПК мечты или покупайте готовые решения с гарантией.</p>
            <div style="display: flex; gap: 20px; margin-top: 20px; flex-wrap: wrap;">
                <div style="flex: 1; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                    <i class="fas fa-truck fa-3x" style="color: #007bff; margin-bottom: 10px;"></i>
                    <h3>Быстрая доставка</h3>
                    <p>По всей России за 2-5 дней</p>
                </div>
                <div style="flex: 1; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                    <i class="fas fa-shield-alt fa-3x" style="color: #28a745; margin-bottom: 10px;"></i>
                    <h3>Гарантия качества</h3>
                    <p>Только сертифицированный товар</p>
                </div>
            </div>
        </section>
    </main>

    <!-- CATALOG SECTION -->
    <main id="catalog-section" class="page-section">
        <!-- Вкладки категорий (из catalog.js / pc.html) -->
        <div id="category-tabs-container" class="category-tabs">
            <!-- Кнопки генерируются JS в зависимости от раздела -->
        </div>

        <h2 id="catalog-title" style="margin-top: 15px;">Каталог товаров</h2>
        
        <div class="catalog-container">
            <!-- Sidebar with Accordions (как в catalog.js) -->
            <aside class="filter-sidebar">
                <h3><i class="fas fa-filter"></i> Фильтры</h3>
                
                <div class="filter-accordion open">
                    <button class="accordion-header open">
                        Цена <i class="fas fa-chevron-down" style="transform: rotate(180deg);"></i>
                    </button>
                    <div class="accordion-content open">
                        <p>До: <span id="price-val" style="font-weight: bold;">300 000 ₽</span></p>
                        <input type="range" id="price-range" min="0" max="300000" step="1000" style="width: 100%;" oninput="app.filterItems()">
                    </div>
                </div>

                <div class="filter-accordion open">
                    <button class="accordion-header open">
                        Бренд <i class="fas fa-chevron-down" style="transform: rotate(180deg);"></i>
                    </button>
                    <div class="accordion-content open">
                        <label><input type="checkbox" class="brand-filter" value="ASUS" onchange="app.filterItems()"> ASUS</label>
                        <label><input type="checkbox" class="brand-filter" value="Apple" onchange="app.filterItems()"> Apple</label>
                        <label><input type="checkbox" class="brand-filter" value="Intel" onchange="app.filterItems()"> Intel</label>
                        <label><input type="checkbox" class="brand-filter" value="AMD" onchange="app.filterItems()"> AMD</label>
                        <label><input type="checkbox" class="brand-filter" value="NVIDIA" onchange="app.filterItems()"> NVIDIA</label>
                        <label><input type="checkbox" class="brand-filter" value="Kingston" onchange="app.filterItems()"> Kingston</label>
                        <label><input type="checkbox" class="brand-filter" value="Samsung" onchange="app.filterItems()"> Samsung</label>
                        <label><input type="checkbox" class="brand-filter" value="Lenovo" onchange="app.filterItems()"> Lenovo</label>
                    </div>
                </div>

                <button onclick="app.resetFilters()" style="width:100%; padding: 10px; margin-top: 15px; border-radius: 5px; border: 1px solid #ccc; background: #eee; cursor: pointer;">Сбросить фильтры</button>
            </aside>

            <section class="product-list">
                <div id="products-grid" class="product-cards-container">
                    <!-- Products injected via JS -->
                </div>
            </section>
        </div>
    </main>

    <!-- CART SECTION -->
    <main id="cart-section" class="page-section">
        <h2 class="cart-title">Ваша корзина</h2>
        
        <!-- Сообщение о пустой корзине (из cart.js) -->
        <div id="cart-empty-msg" style="display: none; text-align: center; padding: 50px; font-size: 18px; color: #555;">
            Ваша корзина пуста. <a onclick="app.navigate('catalog', 'all')" style="color: #007bff; text-decoration: underline; cursor: pointer;">Начать покупки</a>
        </div>

        <div id="cart-content" class="cart-content-grid">
            <div class="cart-items-list" id="cart-items-container">
                <!-- Cart items injected here -->
            </div>
            
            <aside class="cart-summary">
                <h3>Итого по заказу</h3>
                <div class="summary-line" style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span id="summary-count-text">Сумма товаров (0 шт.)</span>
                    <span id="cart-subtotal" style="font-weight: bold;">0 ₽</span>
                </div>
                <div class="summary-line" style="display: flex; justify-content: space-between; margin-bottom: 10px; color: green;">
                    <span>Скидка</span>
                    <span id="cart-discount" class="discount">0 ₽</span>
                </div>
                <div class="summary-line total-line" style="font-size: 1.5em; font-weight: bold; border-top: 2px solid #eee; padding-top: 10px; margin-top: 10px; display: flex; justify-content: space-between;">
                    <span>Общая сумма</span>
                    <span id="cart-total" class="total-price" style="color: #dc3545;">0 ₽</span>
                </div>
                
                <button onclick="alert('Заказ успешно оформлен! Ожидайте звонка.')" class="checkout-btn" style="width: 100%; padding: 15px; margin-top: 20px; background-color: #28a745; color: white; border: none; border-radius: 25px; font-size: 18px; font-weight: bold; cursor: pointer;">
                    Перейти к оформлению <i class="fas fa-chevron-right"></i>
                </button>

                <div class="promo-section">
                    <div class="promo-code-box" style="display: flex; margin-top: 20px;">
                        <input type="text" id="promo-input" placeholder="Введите промокод" style="flex-grow: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px 0 0 5px;">
                        <button onclick="app.applyPromo()" class="apply-promo-btn" style="background-color: #007bff; color: white; border: 1px solid #007bff; padding: 10px 15px; border-radius: 0 5px 5px 0; cursor: pointer;">Применить</button>
                    </div>
                    <p id="promo-msg" style="font-size: 12px; margin-top: 5px;"></p>
                </div>

                <button onclick="app.clearCart()" class="clear-cart-btn" style="width: 100%; background: none; border: 1px solid #dc3545; color: #dc3545; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 15px;">
                    <i class="fas fa-times-circle"></i> Очистить корзину
                </button>
            </aside>
        </div>
    </main>

    <!-- AUTH SECTION -->
    <main id="auth-section" class="page-section">
        <div class="auth-container">
            <h2 id="auth-title">Вход</h2>
            <form id="auth-form" class="auth-form" onsubmit="app.submitAuth(event)">
                <input type="text" id="username" placeholder="Имя пользователя / Login" required>
                <input type="password" id="password" placeholder="Пароль" required>
                <button type="submit" class="auth-btn">Войти</button>
            </form>
            <p class="toggle-auth" onclick="app.toggleAuthMode()">Нет аккаунта? Зарегистрироваться</p>
            <div id="user-profile" style="display: none;">
                <h3>Профиль</h3>
                <p>Вы вошли как: <span id="current-username" style="font-weight: bold;"></span></p>
                <button onclick="app.logout()" class="auth-btn" style="background-color: #dc3545;">Выйти</button>
            </div>
        </div>
    </main>

    <!-- PROMO CODES SECTION -->
    <main id="promo-codes-section" class="page-section">
        <h2 style="text-align: center; color: #007bff; margin-bottom: 30px;">Действующие промокоды</h2>
        <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
            <div style="background: white; padding: 40px; border-radius: 10px; border: 2px dashed #007bff; text-align: center;">
                <h3 style="color: #28a745;">SALE10</h3>
                <p>Скидка 10% на всё</p>
                <small>Действует до конца месяца</small>
            </div>
            <div style="background: white; padding: 40px; border-radius: 10px; border: 2px dashed #dc3545; text-align: center;">
                <h3 style="color: #dc3545;">PC2025</h3>
                <p>Скидка 15% на комплектующие</p>
                <small>Для новых клиентов</small>
            </div>
        </div>
        <p style="text-align: center; margin-top: 30px;">
            Больше промокодов в наших соцсетях: <br>
            <a href="#" style="color: #007bff; font-weight: bold;">Telegram</a> | 
            <a href="#" style="color: #007bff; font-weight: bold;">VKontakte</a>
        </p>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 PC Manager. Все права защищены.</p>
    </footer>

    <script>
        /* --- JAVASCRIPT LOGIC --- */

        // 1. Data Base (Расширенная)
        const productsDB = [
            // Процессоры
            { id: 1, type: 'pc', category: 'cpus', title: 'Intel Core i9-14900K', price: 69990, image: 'https://img.icons8.com/color/96/processor.png', brand: 'Intel' },
            { id: 101, type: 'pc', category: 'cpus', title: 'Intel Core i5-13600K', price: 32000, image: 'https://img.icons8.com/color/96/processor.png', brand: 'Intel' },
            { id: 102, type: 'pc', category: 'cpus', title: 'AMD Ryzen 7 7800X3D', price: 45000, image: 'https://img.icons8.com/color/96/processor.png', brand: 'AMD' },
            
            // Видеокарты
            { id: 2, type: 'pc', category: 'gpus', title: 'ASUS TUF RTX 4080', price: 125500, image: 'https://img.icons8.com/color/96/video-card.png', brand: 'ASUS' },
            { id: 201, type: 'pc', category: 'gpus', title: 'GIGABYTE RTX 4060', price: 35000, image: 'https://img.icons8.com/color/96/video-card.png', brand: 'GIGABYTE' },
            
            // Материнские платы
            { id: 3, type: 'pc', category: 'motherboards', title: 'ASUS ROG STRIX B650', price: 23890, image: 'https://img.icons8.com/color/96/motherboard.png', brand: 'ASUS' },
            
            // Оперативка
            { id: 10, type: 'pc', category: 'rams', title: 'Kingston FURY 32GB', price: 15990, image: 'https://img.icons8.com/color/96/memory-slot.png', brand: 'Kingston' },
            
            // Ноутбуки
            { id: 4, type: 'laptop', category: 'gaming', title: 'ASUS ROG Zephyrus G16', price: 189990, image: 'https://img.icons8.com/color/96/laptop--v1.png', brand: 'ASUS' },
            { id: 5, type: 'laptop', category: 'ultrabook', title: 'Apple MacBook Air 13 M3', price: 135000, image: 'https://img.icons8.com/color/96/mac-os.png', brand: 'Apple' },
            { id: 6, type: 'laptop', category: 'office', title: 'Lenovo IdeaPad Slim 5', price: 42500, image: 'https://img.icons8.com/color/96/laptop--v1.png', brand: 'Lenovo' },
            
            // Моноблоки
            { id: 7, type: 'monoblock', category: 'all-monoblocks', title: 'Apple iMac 24" M3', price: 169990, image: 'https://img.icons8.com/color/96/monitor.png', brand: 'Apple' },
            { id: 8, type: 'monoblock', category: 'monoblocks-gaming', title: 'Dell Inspiron 27 7720', price: 145000, image: 'https://img.icons8.com/color/96/monitor.png', brand: 'Dell' },
            { id: 9, type: 'monoblock', category: 'monoblocks-office', title: 'HP 24-cb1000ur', price: 61500, image: 'https://img.icons8.com/color/96/monitor.png', brand: 'HP' },
            
            // Накопители
            { id: 301, type: 'pc', category: 'storages', title: 'Samsung 980 PRO 1TB', price: 9500, image: 'https://img.icons8.com/color/96/hdd.png', brand: 'Samsung' }
        ];

        const promoCodes = {
            'SALE10': 0.10,
            'PC2025': 0.15
        };

        const app = {
            state: {
                currentTab: 'home',
                cart: JSON.parse(localStorage.getItem('cart')) || [],
                user: JSON.parse(localStorage.getItem('currentUser')) || null,
                usersDB: JSON.parse(localStorage.getItem('usersDB')) || [],
                activePromo: null,
                currentType: 'all', // pc, laptop, monoblock, all
                currentCategoryFilter: 'all', // sub-tab: cpus, gpus, etc.
                searchQuery: ''
            },

            init: function() {
                this.updateHeaderAuth();
                this.updateCartCount();
                this.setupCarousel();
                this.setupAccordions(); // Инициализация аккордеонов из catalog.js
                // Check current hash or default
                this.navigate('home');
            },

            // Navigation
            navigate: function(pageId, type = 'all') {
                // Hide all sections
                document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
                
                // Show requested section logic
                if (pageId === 'home') {
                    document.getElementById('home-section').classList.add('active');
                } else if (pageId === 'catalog') {
                    document.getElementById('catalog-section').classList.add('active');
                    this.setupCatalogTabs(type);
                    this.filterCategory(type, 'all');
                } else if (pageId === 'cart') {
                    document.getElementById('cart-section').classList.add('active');
                    this.renderCart();
                } else if (pageId === 'auth') {
                    document.getElementById('auth-section').classList.add('active');
                    this.renderAuth();
                } else if (pageId === 'promocodes') {
                    document.getElementById('promo-codes-section').classList.add('active');
                }
                
                window.scrollTo(0,0);
            },

            // === ЛОГИКА КАТАЛОГА (из catalog.js) ===
            
            // Настройка вкладок в зависимости от типа страницы (PC, Laptop...)
            setupCatalogTabs: function(type) {
                const container = document.getElementById('category-tabs-container');
                container.innerHTML = '';
                
                let tabs = [];
                if (type === 'pc') {
                    tabs = [
                        {id: 'all', name: 'Все'},
                        {id: 'cpus', name: 'Процессоры'},
                        {id: 'gpus', name: 'Видеокарты'},
                        {id: 'motherboards', name: 'Мат. платы'},
                        {id: 'rams', name: 'ОЗУ'},
                        {id: 'storages', name: 'Накопители'}
                    ];
                } else if (type === 'laptop') {
                    tabs = [
                        {id: 'all', name: 'Все ноутбуки'},
                        {id: 'gaming', name: 'Игровые'},
                        {id: 'ultrabook', name: 'Ультрабуки'},
                        {id: 'office', name: 'Офисные'}
                    ];
                } else if (type === 'monoblock') {
                     tabs = [
                        {id: 'all', name: 'Все моноблоки'},
                        {id: 'monoblocks-gaming', name: 'Игровые'},
                        {id: 'monoblocks-office', name: 'Для офиса'}
                    ];
                } else {
                    tabs = [{id: 'all', name: 'Все товары'}];
                }

                tabs.forEach(t => {
                    const btn = document.createElement('button');
                    btn.className = 'tab-button';
                    if (t.id === 'all') btn.classList.add('active');
                    btn.textContent = t.name;
                    btn.onclick = (e) => {
                        // UI Update
                        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        // Logic Update
                        this.filterCategory(this.state.currentType, t.id);
                        document.getElementById('catalog-title').innerText = t.name;
                    };
                    container.appendChild(btn);
                });
            },

            filterCategory: function(type, categorySubFilter) {
                this.state.currentType = type;
                this.state.currentCategoryFilter = categorySubFilter;
                this.filterItems();
            },

            search: function() {
                const query = document.getElementById('global-search').value.toLowerCase();
                this.state.searchQuery = query;
                this.navigate('catalog', 'all'); // Switch to catalog to show results
            },

            filterItems: function() {
                const container = document.getElementById('products-grid');
                container.innerHTML = '';

                // Get Filter Values
                const maxPrice = document.getElementById('price-range').value;
                document.getElementById('price-val').innerText = parseInt(maxPrice).toLocaleString('ru-RU') + ' ₽';
                
                const selectedBrands = Array.from(document.querySelectorAll('.brand-filter:checked')).map(cb => cb.value);

                const filtered = productsDB.filter(p => {
                    // 1. Type Filter (PC vs Laptop vs Monoblock)
                    const matchesType = this.state.currentType === 'all' ? true : p.type === this.state.currentType;
                    
                    // 2. Sub-Category Filter (Tabs: cpu, gpu...)
                    let matchesSubCat = true;
                    if (this.state.currentCategoryFilter !== 'all') {
                        matchesSubCat = p.category === this.state.currentCategoryFilter;
                    }

                    // 3. Search, Price, Brand
                    const matchesSearch = p.title.toLowerCase().includes(this.state.searchQuery);
                    const matchesPrice = p.price <= maxPrice;
                    const matchesBrand = selectedBrands.length === 0 || selectedBrands.includes(p.brand);

                    return matchesType && matchesSubCat && matchesSearch && matchesPrice && matchesBrand;
                });

                if (filtered.length === 0) {
                    container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; font-size: 1.2em; color: #666;">Товары не найдены.</p>';
                    return;
                }

                filtered.forEach(p => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <div class="card-image-box">
                            <img src="${p.image}" class="product-image" alt="${p.title}">
                        </div>
                        <h3 class="product-title">${p.title}</h3>
                        <div class="product-specs" style="font-size:0.8em; color:#777; margin-bottom:5px;">Бренд: ${p.brand}</div>
                        <div class="product-price">${p.price.toLocaleString('ru-RU')} ₽</div>
                        <button class="buy-button" onclick="app.addToCart(${p.id})">В корзину</button>
                    `;
                    container.appendChild(card);
                });
            },

            resetFilters: function() {
                document.getElementById('price-range').value = 300000;
                document.querySelectorAll('.brand-filter').forEach(cb => cb.checked = false);
                this.state.searchQuery = '';
                document.getElementById('global-search').value = '';
                this.filterItems();
            },

            // === ЛОГИКА АККОРДЕОНОВ (из catalog.js) ===
            setupAccordions: function() {
                const accordionHeaders = document.querySelectorAll('.accordion-header');
                accordionHeaders.forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const isOpen = content.classList.contains('open');
                        const icon = header.querySelector('.fa-chevron-down');

                        if (isOpen) {
                            content.classList.remove('open');
                            header.classList.remove('open');
                            icon.style.transform = 'rotate(0deg)';
                        } else {
                            content.classList.add('open');
                            header.classList.add('open');
                            icon.style.transform = 'rotate(180deg)';
                        }
                    });
                });
            },

            // === КОРЗИНА (Logic from cart.js adapted) ===
            addToCart: function(id) {
                const product = productsDB.find(p => p.id === id);
                const existing = this.state.cart.find(i => i.id === id);

                if (existing) {
                    existing.qty++;
                } else {
                    this.state.cart.push({ ...product, qty: 1 });
                }

                this.saveCart();
                this.updateCartCount();
                
                // Visual feedback
                const btn = event.target;
                const originalText = btn.innerText;
                btn.innerText = "Добавлено!";
                btn.style.background = "#0056b3";
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.style.background = "#28a745";
                }, 1000);
            },

            // Интеграция confirm из cart.js
            removeFromCart: function(id) {
                if (confirm('Вы уверены, что хотите удалить этот товар из корзины?')) {
                    this.state.cart = this.state.cart.filter(i => i.id !== id);
                    this.saveCart();
                    this.renderCart();
                    this.updateCartCount();
                }
            },
            
            // Интеграция confirm из cart.js
            clearCart: function() {
                if (confirm('Вы уверены, что хотите очистить корзину полностью?')) {
                    this.state.cart = [];
                    this.saveCart();
                    this.renderCart();
                    this.updateCartCount();
                }
            },

            changeQty: function(id, delta) {
                const item = this.state.cart.find(i => i.id === id);
                if (item) {
                    // Если количество 1 и нажимаем минус - спрашиваем удаление
                    if (item.qty === 1 && delta === -1) {
                        this.removeFromCart(id);
                        return;
                    }
                    
                    item.qty += delta;
                    this.saveCart();
                    this.renderCart();
                }
            },

            saveCart: function() {
                localStorage.setItem('cart', JSON.stringify(this.state.cart));
            },

            updateCartCount: function() {
                const count = this.state.cart.reduce((sum, i) => sum + i.qty, 0);
                document.getElementById('header-cart-count').innerText = count;
            },

            renderCart: function() {
                const container = document.getElementById('cart-items-container');
                const emptyMsg = document.getElementById('cart-empty-msg');
                const content = document.getElementById('cart-content');

                if (this.state.cart.length === 0) {
                    content.style.display = 'none';
                    emptyMsg.style.display = 'block';
                    return;
                }

                content.style.display = 'grid';
                emptyMsg.style.display = 'none';
                container.innerHTML = '';

                let subtotal = 0;
                let totalQty = 0;

                this.state.cart.forEach(item => {
                    const itemTotal = item.price * item.qty;
                    subtotal += itemTotal;
                    totalQty += item.qty;

                    const div = document.createElement('div');
                    div.className = 'cart-item';
                    div.innerHTML = `
                        <div class="item-info">
                            <img src="${item.image}" style="width:60px; height:60px; object-fit:contain; margin-right:10px;">
                            <div class="item-details">
                                <div style="font-weight:bold;">${item.title}</div>
                                <div style="color:#777; font-size:0.9em;">${item.price.toLocaleString('ru-RU')} ₽ / шт.</div>
                            </div>
                        </div>
                        <div class="item-controls">
                            <button class="quantity-btn minus" onclick="app.changeQty(${item.id}, -1)"><i class="fas fa-minus"></i></button>
                            <span class="quantity-input" style="width:30px; text-align:center;">${item.qty}</span>
                            <button class="quantity-btn plus" onclick="app.changeQty(${item.id}, 1)"><i class="fas fa-plus"></i></button>
                            <span class="total-price-value" style="font-weight:bold; color:#dc3545; margin-left:15px; min-width:80px; text-align:right;">${itemTotal.toLocaleString('ru-RU')} ₽</span>
                            <button onclick="app.removeFromCart(${item.id})" class="item-remove-btn" style="border:none; background:none; color:red; cursor:pointer; font-size:1.1em; margin-left:10px;"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    `;
                    container.appendChild(div);
                });

                document.getElementById('summary-count-text').innerText = `Сумма товаров (${totalQty} шт.)`;
                document.getElementById('cart-subtotal').innerText = subtotal.toLocaleString('ru-RU') + ' ₽';
                
                let discount = 0;
                if (this.state.activePromo) {
                    discount = Math.floor(subtotal * this.state.activePromo);
                }
                document.getElementById('cart-discount').innerText = discount.toLocaleString('ru-RU') + ' ₽';
                document.getElementById('cart-total').innerText = (subtotal - discount).toLocaleString('ru-RU') + ' ₽';
            },

            applyPromo: function() {
                const input = document.getElementById('promo-input').value.trim();
                const msg = document.getElementById('promo-msg');
                
                if (promoCodes[input]) {
                    this.state.activePromo = promoCodes[input];
                    msg.innerText = "Промокод применен!";
                    msg.style.color = "green";
                    this.renderCart();
                } else {
                    this.state.activePromo = null;
                    msg.innerText = "Неверный промокод";
                    msg.style.color = "red";
                    this.renderCart();
                }
            },

            // Auth Logic
            handleAuthClick: function() {
                if (this.state.user) {
                    this.navigate('auth');
                } else {
                    this.navigate('auth');
                }
            },

            isLoginMode: true,
            
            toggleAuthMode: function() {
                this.isLoginMode = !this.isLoginMode;
                document.getElementById('auth-title').innerText = this.isLoginMode ? 'Вход' : 'Регистрация';
                document.querySelector('.auth-btn').innerText = this.isLoginMode ? 'Войти' : 'Зарегистрироваться';
                document.querySelector('.toggle-auth').innerText = this.isLoginMode ? 'Нет аккаунта? Зарегистрироваться' : 'Есть аккаунт? Войти';
            },

            submitAuth: function(e) {
                e.preventDefault();
                const u = document.getElementById('username').value;
                const p = document.getElementById('password').value;

                if (this.isLoginMode) {
                    const foundUser = this.state.usersDB.find(user => user.username === u && user.password === p);
                    if (foundUser) {
                        this.login(foundUser);
                    } else {
                        alert('Неверный логин или пароль');
                    }
                } else {
                    if (this.state.usersDB.find(user => user.username === u)) {
                        alert('Пользователь уже существует');
                        return;
                    }
                    const newUser = { username: u, password: p };
                    this.state.usersDB.push(newUser);
                    localStorage.setItem('usersDB', JSON.stringify(this.state.usersDB));
                    this.login(newUser);
                }
            },

            login: function(user) {
                this.state.user = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                this.updateHeaderAuth();
                this.navigate('home');
            },

            logout: function() {
                this.state.user = null;
                localStorage.removeItem('currentUser');
                this.updateHeaderAuth();
                this.renderAuth();
            },

            updateHeaderAuth: function() {
                const link = document.getElementById('auth-text');
                if (this.state.user) {
                    link.innerText = this.state.user.username;
                } else {
                    link.innerText = "Войти";
                }
            },

            renderAuth: function() {
                const form = document.getElementById('auth-form');
                const profile = document.getElementById('user-profile');
                const title = document.getElementById('auth-title');
                const toggle = document.querySelector('.toggle-auth');

                if (this.state.user) {
                    form.style.display = 'none';
                    toggle.style.display = 'none';
                    profile.style.display = 'block';
                    title.innerText = 'Мой кабинет';
                    document.getElementById('current-username').innerText = this.state.user.username;
                } else {
                    form.style.display = 'block';
                    toggle.style.display = 'block';
                    profile.style.display = 'none';
                    title.innerText = this.isLoginMode ? 'Вход' : 'Регистрация';
                }
            },

            // Carousel
            setupCarousel: function() {
                let slideIndex = 0;
                const slides = document.querySelectorAll('.carousel-slide');
                
                setInterval(() => {
                    slides[slideIndex].classList.remove('active');
                    slideIndex = (slideIndex + 1) % slides.length;
                    slides[slideIndex].classList.add('active');
                }, 4000);
            }
        };

        // Start App
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>